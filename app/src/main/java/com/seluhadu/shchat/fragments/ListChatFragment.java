package com.seluhadu.shchat.fragments;import android.content.Intent;import android.os.Bundle;import androidx.annotation.NonNull;import androidx.annotation.Nullable;import androidx.fragment.app.Fragment;import androidx.recyclerview.widget.LinearLayoutManager;import androidx.recyclerview.widget.RecyclerView;import butterknife.BindView;import butterknife.ButterKnife;import android.view.LayoutInflater;import android.view.View;import android.view.ViewGroup;import com.google.firebase.auth.FirebaseAuth;import com.google.firebase.firestore.DocumentChange;import com.google.firebase.firestore.EventListener;import com.google.firebase.firestore.FirebaseFirestore;import com.google.firebase.firestore.FirebaseFirestoreException;import com.google.firebase.firestore.ListenerRegistration;import com.google.firebase.firestore.QuerySnapshot;import com.seluhadu.shchat.ChatActivity;import com.seluhadu.shchat.R;import com.seluhadu.shchat.adapters.ListUsersAdapter;import com.seluhadu.shchat.models.User;import java.util.ArrayList;import java.util.List;public class ListChatFragment extends Fragment {    private ListUsersAdapter adapter;    private FirebaseFirestore mFireStore;    private ListenerRegistration mListener;    private List<User> mListUsers;    @BindView(R.id.list_users_recycler_view)    RecyclerView mRecyclerView;    @Override    public void onCreate(@Nullable Bundle savedInstanceState) {        super.onCreate(savedInstanceState);        mFireStore = FirebaseFirestore.getInstance();    }    @Nullable    @Override    public View onCreateView(@NonNull final LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {        View rootView = inflater.inflate(R.layout.fragment_list_users, container, false);        ButterKnife.bind(this, rootView);        mListUsers = new ArrayList<>();        adapter = new ListUsersAdapter(mListUsers, getActivity());        mRecyclerView.setAdapter(adapter);        mRecyclerView.setLayoutManager(new LinearLayoutManager(getActivity()));        loadInformation();        adapter.setOnItemClickListener((user, position) -> {            Intent intentToChat = new Intent(getActivity(), ChatActivity.class);            intentToChat.putExtra("senderId", FirebaseAuth.getInstance().getCurrentUser().getUid());            intentToChat.putExtra("receiverId", user.getUserId());            Intent test = new Intent(getActivity(), ChatActivity.class);            test.putExtra("user", user);            startActivity(test);        });        return rootView;    }    private void loadInformation() {        mListener = mFireStore.collection("Users").addSnapshotListener((queryDocumentSnapshots, e) -> {            if (e != null) return;            for (DocumentChange d : queryDocumentSnapshots.getDocumentChanges()) {                User user = d.getDocument().toObject(User.class);                if (!user.getUserId().equals(FirebaseAuth.getInstance().getCurrentUser().getUid())) {                    mListUsers.add(user);                    adapter.notifyDataSetChanged();                }            }        });    }    @Override    public void onDestroy() {        super.onDestroy();        mListener.remove();    }}